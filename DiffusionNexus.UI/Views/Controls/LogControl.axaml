<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="using:DiffusionNexus.UI.Converters"
             xmlns:vm="using:DiffusionNexus.UI.ViewModels"
             xmlns:models="using:DiffusionNexus.UI.Models"
             x:Class="DiffusionNexus.UI.Views.Controls.LogControl"
             x:DataType="vm:LogViewModel">
  <UserControl.Resources>
    <conv:LogLevelToBrushConverter x:Key="LogLevelToBrushConverter" />
  </UserControl.Resources>

  <Grid RowDefinitions="Auto,*">
    <!-- Status Bar -->
    <Border Grid.Row="0"
            Background="{Binding LatestEntry.Level, Converter={StaticResource LogLevelToBrushConverter}}">
      <Grid ColumnDefinitions="*,Auto" Height="24" VerticalAlignment="Center">
        <TextBlock Text="{Binding LatestEntry.Message}"
                 Margin="5,0"
                 VerticalAlignment="Center" />
        <ToggleButton Grid.Column="1"
                    Width="200"
                    Content="^"
                    IsChecked="{Binding IsOverlayVisible, Mode=TwoWay}"/>
      </Grid>
    </Border>

    <!-- Overlay -->
    <Border Grid.Row="1"
            Background="#80000000"
            IsVisible="{Binding IsOverlayVisible}">
      <Border Background="#FF2D2D30"
              Padding="10"
              Width="600"
              HorizontalAlignment="Center"
              VerticalAlignment="Bottom"
              Margin="0,0,0,40">
        <ScrollViewer Height="200">
          <ItemsControl ItemsSource="{Binding Entries}">
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="models:LogEntry">
                <StackPanel Orientation="Horizontal"
                          Spacing="10"
                          Margin="0,2">
                  <TextBlock Width="150"
                           Text="{Binding Timestamp, StringFormat=HH:mm:ss dd.MM.yyyy}"/>
                  <TextBlock Width="70"
                           Text="{Binding Level}"
                           Foreground="White"
                           Background="{Binding Level, Converter={StaticResource LogLevelToBrushConverter}}"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"/>
                  <TextBlock Text="{Binding Message}"/>
                </StackPanel>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>
      </Border>
    </Border>
  </Grid>
</UserControl>