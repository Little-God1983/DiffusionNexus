<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:DiffusionNexus.UI.ViewModels"
        xmlns:html="clr-namespace:TheArtOfDev.HtmlRenderer.Avalonia;assembly=Avalonia.HtmlRenderer"
        x:Class="DiffusionNexus.UI.Views.LoraDetailWindow"
        x:DataType="vm:LoraDetailViewModel"
        Width="900"
        Height="650"
        Title="LoRA Details"
        WindowStartupLocation="CenterOwner">
  <Window.Styles>
    <Style Selector="Button.tag-pill">
      <Setter Property="Background" Value="#2B2B2B"/>
      <Setter Property="BorderBrush" Value="#3F3F3F"/>
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="6"/>
      <Setter Property="Foreground" Value="#E0E0E0"/>
      <Setter Property="Padding" Value="6,4"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="Margin" Value="0,0,6,6"/>
      <Setter Property="IsHitTestVisible" Value="False"/>
    </Style>

    <Style Selector="TextBlock.meta-label">
      <Setter Property="FontWeight" Value="SemiBold"/>
      <Setter Property="Foreground" Value="#B0B0B0"/>
      <Setter Property="Margin" Value="0,0,12,0"/>
    </Style>
  </Window.Styles>

  <Grid Margin="20" RowDefinitions="Auto,Auto,*,Auto,Auto" RowSpacing="18">
    <TextBlock Grid.Row="0"
               Text="{Binding ModelName}"
               FontSize="28"
               FontWeight="Bold"
               TextWrapping="Wrap"/>

    <ItemsControl Grid.Row="1"
                  ItemsSource="{Binding Tags}"
                  IsVisible="{Binding HasTags}">
      <ItemsControl.ItemsPanel>
        <ItemsPanelTemplate>
          <WrapPanel />
        </ItemsPanelTemplate>
      </ItemsControl.ItemsPanel>
      <ItemsControl.ItemTemplate>
        <DataTemplate>
          <Button Classes="tag-pill" Content="{Binding .}" />
        </DataTemplate>
      </ItemsControl.ItemTemplate>
    </ItemsControl>

    <Grid Grid.Row="2" ColumnDefinitions="2*,3*" ColumnSpacing="18">
      <Border Background="#1E1E1E"
              CornerRadius="10"
              Padding="10">
        <Grid>
          <Image Source="{Binding VideoFrame}"
                 Stretch="Uniform"
                 IsVisible="{Binding HasVideo}"/>
          <Image Source="{Binding Card.PreviewImage}"
                 Stretch="Uniform"
                 IsVisible="{Binding ShouldShowImage}"/>
          <TextBlock Text="No preview available"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center"
                     FontStyle="Italic"
                     Foreground="#AAAAAA"
                     IsVisible="{Binding ShowPlaceholder}"/>
        </Grid>
      </Border>

      <Border Grid.Column="1"
              Background="#1E1E1E"
              CornerRadius="10"
              Padding="16">
        <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="12" ColumnDefinitions="Auto,*">
          <TextBlock Grid.Row="0" Grid.Column="0" Text="Model ID:" Classes="meta-label"/>
          <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding ModelId}" TextWrapping="Wrap"/>

          <TextBlock Grid.Row="1" Grid.Column="0" Text="Version ID:" Classes="meta-label"/>
          <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding ModelVersionId}" TextWrapping="Wrap"/>

          <TextBlock Grid.Row="2" Grid.Column="0" Text="Base Model:" Classes="meta-label"/>
          <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding BaseModel}" TextWrapping="Wrap"/>

          <TextBlock Grid.Row="3" Grid.Column="0" Text="File:" Classes="meta-label"/>
          <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding FileName}" TextWrapping="Wrap"/>

          <TextBlock Grid.Row="4" Grid.Column="0" Text="Type:" Classes="meta-label"/>
          <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding ModelType}" TextWrapping="Wrap"/>
        </Grid>
      </Border>
    </Grid>

    <Grid Grid.Row="3" RowDefinitions="Auto,*" RowSpacing="6">
      <TextBlock Text="Description" FontWeight="SemiBold" FontSize="16"/>
      <Border Grid.Row="1"
              Background="#1E1E1E"
              CornerRadius="8"
              Padding="0"
              ClipToBounds="True">
        <Grid>
          <html:HtmlPanel x:Name="DescriptionHtmlPanel"
                          IsVisible="False"
                          Background="Transparent"
                          BorderThickness="0"
                          Padding="0"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"/>
          <ScrollViewer x:Name="DescriptionFallbackScroll"
                        IsVisible="False"
                        MaxHeight="320"
                        Padding="12">
            <TextBlock x:Name="DescriptionFallbackText"
                       Text="{Binding Description}"
                       TextWrapping="Wrap"/>
          </ScrollViewer>
          <TextBlock x:Name="DescriptionPlaceholder"
                     Text="No description provided."
                     FontStyle="Italic"
                     Foreground="#AAAAAA"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center"
                     IsVisible="False"/>
        </Grid>
      </Border>
    </Grid>

    <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8">
      <Button Content="ðŸŒ" Width="44" Height="44" FontSize="18" Command="{Binding Card.OpenWebCommand}"/>
      <Button Content="ðŸ“‹" Width="44" Height="44" FontSize="18" Command="{Binding Card.CopyCommand}"/>
      <Button Content="N" Width="44" Height="44" FontSize="18" Command="{Binding Card.CopyNameCommand}"/>
      <Button Content="ðŸ“‚" Width="44" Height="44" FontSize="18" Command="{Binding Card.OpenFolderCommand}"/>
      <Button Content="âŒ" Width="44" Height="44" FontSize="18" Command="{Binding Card.DeleteCommand}"/>
    </StackPanel>
  </Grid>
</Window>
