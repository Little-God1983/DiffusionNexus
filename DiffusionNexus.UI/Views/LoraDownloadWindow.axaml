<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:DiffusionNexus.UI.ViewModels"
        xmlns:conv="using:DiffusionNexus.UI.Converters"
        x:Class="DiffusionNexus.UI.Views.LoraDownloadWindow"
        x:DataType="vm:LoraDownloadViewModel"
        Width="520"
        Height="360"
        Title="Download LoRA"
        WindowStartupLocation="CenterOwner">
  <Window.Resources>
    <conv:BooleanNotConverter x:Key="BooleanNotConverter"/>
  </Window.Resources>
  <Grid Margin="20" RowDefinitions="Auto,Auto,Auto,*,Auto" RowSpacing="16">
    <StackPanel Grid.Row="0" Spacing="6">
      <TextBlock Text="Civitai Link" FontWeight="SemiBold"/>
      <TextBox Text="{Binding CivitaiUrl, Mode=TwoWay}"
               MinWidth="400"
               IsEnabled="{Binding IsDownloading, Converter={StaticResource BooleanNotConverter}}"/>
    </StackPanel>

    <StackPanel Grid.Row="1" Spacing="6">
      <TextBlock Text="Target Folder" FontWeight="SemiBold"/>
      <ComboBox ItemsSource="{Binding Targets}"
                SelectedItem="{Binding SelectedTarget, Mode=TwoWay}"
                IsEnabled="{Binding IsDownloading, Converter={StaticResource BooleanNotConverter}}">
        <ComboBox.ItemTemplate>
          <DataTemplate>
            <TextBlock Text="{Binding DisplayName}"/>
          </DataTemplate>
        </ComboBox.ItemTemplate>
      </ComboBox>
    </StackPanel>

    <StackPanel Grid.Row="2" Spacing="8">
      <ProgressBar Minimum="0"
                   Maximum="100"
                   Height="20"
                   Value="{Binding ProgressValue}"/>
      <StackPanel Orientation="Horizontal" Spacing="12">
        <TextBlock Text="{Binding ProgressMessage}"/>
        <TextBlock Text="{Binding SpeedDisplay}" Foreground="#888888"/>
      </StackPanel>
    </StackPanel>

    <Border Grid.Row="3" Background="#1E1E1E" CornerRadius="6" Padding="12">
      <TextBlock Text="{Binding StatusMessage}" TextWrapping="Wrap" Foreground="{Binding StatusForeground}"/>
    </Border>

    <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="10">
      <Button Content="OK"
              IsDefault="True"
              Width="100"
              Command="{Binding StartDownloadCommand}"/>
      <Button Content="Cancel"
              IsCancel="True"
              Width="100"
              Command="{Binding CancelCommand}"/>
    </StackPanel>
  </Grid>
</Window>
