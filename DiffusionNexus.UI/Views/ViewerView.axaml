<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:DiffusionNexus.UI.ViewModels"
             xmlns:converters="using:DiffusionNexus.UI.Converters"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="DiffusionNexus.UI.Views.ViewerView"
             x:DataType="vm:ViewerViewModel">

  <Design.DataContext>
    <vm:ViewerViewModel/>
  </Design.DataContext>

  <UserControl.Resources>
    <converters:PathToBitmapConverter x:Key="PathToBitmapConverter"/>
  </UserControl.Resources>

  <Grid RowDefinitions="Auto,*">

    <!-- Toolbar -->
    <Border Grid.Row="0"
            Background="#1E1E1E"
            Padding="16,12"
            BorderBrush="#333"
            BorderThickness="0,0,0,1">
      <Grid ColumnDefinitions="Auto,Auto,*,Auto" RowDefinitions="Auto">
        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
          <TextBlock Text="Tile Size" VerticalAlignment="Center"/>
          <Slider Width="200"
                  Minimum="120"
                  Maximum="360"
                  Value="{Binding TileWidth, Mode=TwoWay}"/>
          <TextBlock Text="{Binding TileWidth, StringFormat={}{0:0}px}" VerticalAlignment="Center"/>
        </StackPanel>

        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center" Margin="24,0,0,0">
          <TextBlock Text="Sort by" VerticalAlignment="Center"/>
          <ComboBox ItemsSource="{Binding SortOptions}"
                    SelectedItem="{Binding SelectedSortOption, Mode=TwoWay}"
                    DisplayMemberPath="DisplayName"
                    Width="180"/>
        </StackPanel>

        <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
          <Button Content="Refresh" Command="{Binding RefreshCommand}"/>
        </StackPanel>
      </Grid>
    </Border>

    <Grid Grid.Row="1">
      <ScrollViewer Padding="16" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
        <ItemsControl ItemsSource="{Binding MediaItems}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <WrapPanel Orientation="Horizontal"/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate x:DataType="vm:ViewerMediaItemViewModel">
              <Border Margin="8"
                      Width="{Binding DataContext.TileWidth, RelativeSource={RelativeSource AncestorType=UserControl}}"
                      Height="{Binding DataContext.TileWidth, RelativeSource={RelativeSource AncestorType=UserControl}}"
                      Background="#1A1A1A"
                      BorderBrush="#333"
                      BorderThickness="1"
                      CornerRadius="8"
                      ClipToBounds="True">
                <Grid>
                  <Image Source="{Binding FilePath, Converter={StaticResource PathToBitmapConverter}}"
                         Stretch="UniformToFill"
                         IsVisible="{Binding IsImage}"/>

                  <Border Background="Black" IsVisible="{Binding IsVideo}">
                    <Viewbox Stretch="Uniform">
                      <TextBlock Text="Video" Foreground="White" FontSize="24"/>
                    </Viewbox>
                  </Border>

                  <Border Background="#80000000"
                          CornerRadius="4"
                          Padding="6,2"
                          HorizontalAlignment="Right"
                          VerticalAlignment="Top"
                          Margin="6">
                    <TextBlock Text="{Binding FormatTag}" FontSize="10" Foreground="White"/>
                  </Border>
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>

      <Border IsVisible="{Binding !HasMedia}"
              Background="#1A1A1A"
              CornerRadius="8"
              Margin="16"
              Padding="32"
              HorizontalAlignment="Center"
              VerticalAlignment="Center">
        <StackPanel Spacing="16" HorizontalAlignment="Center">
          <TextBlock Text="ðŸ–¼ï¸" FontSize="64" HorizontalAlignment="Center" Opacity="0.4"/>
          <TextBlock Text="No Images Found" FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center"/>
          <TextBlock Text="Add Image Gallery folders in Settings to view your images and videos." Opacity="0.6" HorizontalAlignment="Center"/>
          <Button Content="Open Settings"
                  Command="{Binding OpenSettingsCommand}"
                  HorizontalAlignment="Center"
                  Padding="16,10"
                  FontSize="14"
                  Background="#4CAF50"
                  Foreground="White"/>
        </StackPanel>
      </Border>
    </Grid>
  </Grid>
</UserControl>
