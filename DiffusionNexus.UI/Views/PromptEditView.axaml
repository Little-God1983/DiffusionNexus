<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:DiffusionNexus.UI.ViewModels"
             x:Class="DiffusionNexus.UI.Views.PromptEditView"
             xmlns:local="using:DiffusionNexus.UI.Views"
             x:DataType="vm:PromptEditViewModel">
  <UserControl.DataContext>
    <vm:PromptEditViewModel/>
  </UserControl.DataContext>
  <TabControl>
    <TabItem Header="Single Image">
      <Grid Margin="10" RowDefinitions="*">
        <Grid.ColumnDefinitions>
          <ColumnDefinition MinWidth="200"/>
          <ColumnDefinition MinWidth="150"/>
          <ColumnDefinition MinWidth="250"/>
        </Grid.ColumnDefinitions>
        <!-- Image drop area -->
        <Border Grid.Column="0" DragDrop.AllowDrop="True"  x:Name="ImageDropBorder" BorderBrush="Gray" BorderThickness="1" Background="#22FFFFFF" CornerRadius="4" Margin="0,0,10,0">
          <Grid>
            <Image Stretch="Uniform" Margin="5" Source="{Binding PreviewImage}" IsVisible="{Binding IsPreviewVisible}" />
            <TextBlock Text="{Binding DropText}"  HorizontalAlignment="Center" VerticalAlignment="Center"/>
          </Grid>
        </Border>

        <!-- Middle side for Meta Data -->
        <Border Grid.Column="1" BorderBrush="Gray" BorderThickness="1" Background="#22FFFFFF" CornerRadius="4" Margin="0,0,10,0">
          <StackPanel x:Name="MetadataPanel" Spacing="4" Margin="0,10,0,0">
            <TextBlock Text="Metadata" Width="120"/>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="Steps" Width="120"/>
              <TextBox Text="{Binding Steps}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="Sampler" Width="120"/>
              <TextBox Text="{Binding Sampler}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="Schedule Type" Width="120"/>
              <TextBox Text="{Binding ScheduleType}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="CFG Scale" Width="120"/>
              <TextBox Text="{Binding CfgScale}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="Seed" Width="120"/>
              <TextBox Text="{Binding Seed}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="Face Restoration" Width="120"/>
              <TextBox Text="{Binding FaceRestoration}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="Size" Width="120"/>
              <TextBox Text="{Binding Size}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="Model Hash" Width="120"/>
              <TextBox Text="{Binding ModelHash}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="Model" Width="120"/>
              <TextBox Text="{Binding Model}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="TI" Width="120"/>
              <TextBox Text="{Binding Ti}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="Version" Width="120"/>
              <TextBox Text="{Binding Version}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="Source Identifier" Width="120"/>
              <TextBox Text="{Binding SourceIdentifier}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="LoRA Hashes" Width="120"/>
              <TextBox Text="{Binding LoRAHashes}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="Width" Width="120"/>
              <TextBox Text="{Binding Width}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="5">
              <TextBlock Text="Height" Width="120"/>
              <TextBox Text="{Binding Height}" IsReadOnly="True" Width="200"/>
            </StackPanel>
            <StackPanel Spacing="2">
              <TextBlock Text="Hashes"/>
              <TextBox FontFamily="Consolas" Text="{Binding Hashes}" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap" Height="60"/>
            </StackPanel>
            <StackPanel Spacing="2">
              <TextBlock Text="Resources"/>
              <TextBox FontFamily="Consolas" Text="{Binding Resources}" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap" Height="60"/>
            </StackPanel>
            <Button Content="Copy all metadata" HorizontalAlignment="Right" Width="150" Command="{Binding CopyMetadataCommand}" CommandParameter="{Binding $parent[UserControl].VisualRoot}"/>
          </StackPanel>
        </Border>

        <!-- Right side for prompts -->
        <StackPanel Grid.Column="2" Spacing="10">
          <local:PromptEditorControl Margin="10"
             DataContext="{Binding SinglePromptVm}"
             HorizontalAlignment="Stretch"
             VerticalAlignment="Stretch"/>
          <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="10">
            <Button Content="Apply List" Width="110" Command="{Binding ApplyBlacklistCommand}"/>
            <Button Content="Save" Width="80" Command="{Binding SaveCommand}" CommandParameter="{Binding $parent[UserControl].VisualRoot}"/>
            <Button Content="Save As" Width="80" Command="{Binding SaveAsCommand}"/>
          </StackPanel>

        </StackPanel>

      </Grid>
    </TabItem>
    <TabItem Header="Batch Process">
      <Grid x:DataType="vm:BatchProcessingViewModel" DataContext="{Binding BatchViewModel}"
      Margin="10"
      ColumnDefinitions="400,*">
        <Image
            Source="avares://DiffusionNexus.UI/Assets/under_construction.png" Opacity="0.75" Grid.Column="0" Grid.ColumnSpan="2"/>
        <StackPanel Spacing="10" Grid.Column="0">
          <StackPanel Orientation="Horizontal" Spacing="5">
            <TextBlock Text="Source Folder" Width="100"/>
            <TextBox x:Name="SourceFolderBox" Width="140" Text="{Binding SourceFolder, Mode=TwoWay}"/>
            <Button Content="Browse..." Command="{Binding BrowseSourceFolderCommand}" CommandParameter="{Binding $parent[UserControl].VisualRoot}" />
          </StackPanel>
          <StackPanel Orientation="Horizontal" Spacing="5">
            <TextBlock Text="Target Folder" Width="100"/>
            <TextBox x:Name="TargetFolderBox" Width="140" Text="{Binding TargetFolder, Mode=TwoWay}"/>
            <Button Content="Browse..." Command="{Binding BrowseTargetFolderCommand}" CommandParameter="{Binding $parent[UserControl].VisualRoot}" />
          </StackPanel>
          <StackPanel Orientation="Vertical" Spacing="5">
            <RadioButton Content="Blacklist / Whitelist only" IsChecked="{Binding UseListOnly, Mode=TwoWay}"/>
            <RadioButton Content="Replace all" IsChecked="{Binding ReplaceAll, Mode=TwoWay}"/>
          </StackPanel>
        </StackPanel>
        <StackPanel Grid.Column="0" Spacing="10">        
        </StackPanel>
        <StackPanel Grid.Column="1">
          <local:PromptEditorControl Margin="10"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"/>
          <Button Name="ApplyBatchButton" Content="Apply to Batch" Width="120"/>
        </StackPanel>
      </Grid>
    </TabItem>
  </TabControl>
</UserControl>
