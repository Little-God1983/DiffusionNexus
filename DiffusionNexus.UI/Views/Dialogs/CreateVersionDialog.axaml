<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:DiffusionNexus.UI.ViewModels"
        xmlns:converters="using:DiffusionNexus.UI.Converters"
        x:Class="DiffusionNexus.UI.Views.Dialogs.CreateVersionDialog"
        x:DataType="vm:CreateVersionDialogViewModel"
        Width="900"
        SizeToContent="Height"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        Background="#252526">
  
  <Grid Margin="24" RowDefinitions="Auto,*,Auto">
    
    <!-- Title -->
    <StackPanel Grid.Row="0" Margin="0,0,0,20">
      <TextBlock Text="Create New Version"
                 FontSize="18"
                 FontWeight="SemiBold"
                 Foreground="#4CAF50"/>
    </StackPanel>

    <!-- Main Content Area -->
    <Grid Grid.Row="1" ColumnDefinitions="*,24,*" Margin="0,0,0,24">
      
      <!-- Left Column: Source & Ratings -->
      <StackPanel Grid.Column="0">
        <!-- Source Options -->
        <StackPanel Margin="0,0,0,20">
          <TextBlock Text="How would you like to initialize the new version?"
                     FontWeight="SemiBold"
                     Margin="0,0,0,12"/>
          
          <!-- Start Fresh Option -->
          <Border Background="#1A1A1A" 
                  CornerRadius="8" 
                  Padding="16,12" 
                  Margin="0,0,0,8"
                  BorderThickness="2"
                  BorderBrush="{Binding IsStartFresh, Converter={x:Static converters:BoolConverters.ToAccentBorder}}">
            <Grid ColumnDefinitions="Auto,*">
              <RadioButton Grid.Column="0"
                           GroupName="SourceOption"
                           IsChecked="{Binding IsStartFresh, Mode=TwoWay}"
                           VerticalAlignment="Center"
                           Margin="0,0,12,0"/>
              <StackPanel Grid.Column="1">
                <TextBlock Text="Start Fresh (Empty)"
                           FontWeight="SemiBold"
                           FontSize="14"/>
                <TextBlock Text="Create an empty version and add new content"
                           Opacity="0.6"
                           FontSize="12"
                           Margin="0,4,0,0"/>
              </StackPanel>
            </Grid>
          </Border>
          
          <!-- Copy from Version Option -->
          <Border Background="#1A1A1A" 
                  CornerRadius="8" 
                  Padding="16,12"
                  BorderThickness="2"
                  BorderBrush="{Binding IsCopyFromVersion, Converter={x:Static converters:BoolConverters.ToAccentBorder}}"
                  IsEnabled="{Binding HasAnyContent}">
            <Grid ColumnDefinitions="Auto,*">
              <RadioButton Grid.Column="0"
                           GroupName="SourceOption"
                           IsChecked="{Binding IsCopyFromVersion, Mode=TwoWay}"
                           VerticalAlignment="Top"
                           Margin="0,2,12,0"/>
              <StackPanel Grid.Column="1">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <TextBlock Text="Copy from Version"
                             FontWeight="SemiBold"
                             FontSize="14"
                             VerticalAlignment="Center"/>
                  <ComboBox ItemsSource="{Binding AvailableVersions}"
                            SelectedItem="{Binding SelectedSourceVersion}"
                            MinWidth="70"
                            IsEnabled="{Binding IsCopyFromVersion}">
                    <ComboBox.ItemTemplate>
                      <DataTemplate>
                        <TextBlock Text="{Binding StringFormat='V{0}'}"/>
                      </DataTemplate>
                    </ComboBox.ItemTemplate>
                  </ComboBox>
                </StackPanel>
                <TextBlock Text="{Binding ContentSummary, StringFormat='Available: {0}'}"
                           Opacity="0.6"
                           FontSize="12"
                           Margin="0,4,0,0"/>
              </StackPanel>
            </Grid>
          </Border>
        </StackPanel>
        
        <!-- Rating Selection (when Copy is selected) -->
        <StackPanel Margin="0,0,0,16" IsVisible="{Binding IsCopyFromVersion}">
          <TextBlock Text="Include Media by Rating"
                     FontWeight="SemiBold"
                     Margin="0,0,0,8"/>
          
          <!-- Production Ready -->
          <CheckBox IsChecked="{Binding IncludeProductionReady}"
                    Margin="0,4">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <Ellipse Width="10" Height="10" Fill="#4CAF50" VerticalAlignment="Center"/>
              <TextBlock Text="Production Ready" Foreground="#4CAF50"/>
              <TextBlock Text="{Binding ProductionReadyCount, StringFormat='({0})'}" Opacity="0.7"/>
            </StackPanel>
          </CheckBox>
          
          <!-- Unrated -->
          <CheckBox IsChecked="{Binding IncludeUnrated}"
                    Margin="0,4">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <Ellipse Width="10" Height="10" Fill="#888" VerticalAlignment="Center"/>
              <TextBlock Text="Unrated"/>
              <TextBlock Text="{Binding UnratedCount, StringFormat='({0})'}" Opacity="0.7"/>
            </StackPanel>
          </CheckBox>
          
          <!-- Trash -->
          <CheckBox IsChecked="{Binding IncludeTrash}"
                    Margin="0,4">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <Ellipse Width="10" Height="10" Fill="#F44336" VerticalAlignment="Center"/>
              <TextBlock Text="Trash" Foreground="#F44336"/>
              <TextBlock Text="{Binding TrashCount, StringFormat='({0})'}" Opacity="0.7"/>
            </StackPanel>
          </CheckBox>
        </StackPanel>
      </StackPanel>
      
      <!-- Right Column: Content Selection & Info -->
      <StackPanel Grid.Column="2">
        <!-- Content Type Selection (when Copy is selected) -->
        <Border Background="#1A1A1A" 
                CornerRadius="8" 
                Padding="16"
                Margin="0,0,0,20"
                IsVisible="{Binding IsCopyFromVersion}">
          <StackPanel>
            <TextBlock Text="Select content to copy:"
                       FontWeight="SemiBold"
                       Margin="0,0,0,12"/>
            
            <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="*,Auto">
              <!-- Images -->
              <CheckBox Grid.Row="0" Grid.Column="0"
                        IsChecked="{Binding CopyImages, Mode=TwoWay}"
                        IsEnabled="{Binding HasImages}"
                        Margin="0,0,0,8">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <TextBlock Text="Images" VerticalAlignment="Center"/>
                  <TextBlock Text="{Binding ImageExtensionsDisplay}"
                             Opacity="0.5"
                             FontSize="11"
                             VerticalAlignment="Center"/>
                </StackPanel>
              </CheckBox>
              <Border Grid.Row="0" Grid.Column="1"
                      Background="#333"
                      CornerRadius="4"
                      Padding="8,4"
                      VerticalAlignment="Center">
                <TextBlock Text="{Binding ImageCount}"
                           FontWeight="SemiBold"
                           Foreground="#4CAF50"/>
              </Border>
              
              <!-- Videos -->
              <CheckBox Grid.Row="1" Grid.Column="0"
                        IsChecked="{Binding CopyVideos, Mode=TwoWay}"
                        IsEnabled="{Binding HasVideos}"
                        Margin="0,0,0,8">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <TextBlock Text="Videos" VerticalAlignment="Center"/>
                  <TextBlock Text="{Binding VideoExtensionsDisplay}"
                             Opacity="0.5"
                             FontSize="11"
                             VerticalAlignment="Center"/>
                </StackPanel>
              </CheckBox>
              <Border Grid.Row="1" Grid.Column="1"
                      Background="#333"
                      CornerRadius="4"
                      Padding="8,4"
                      VerticalAlignment="Center">
                <TextBlock Text="{Binding VideoCount}"
                           FontWeight="SemiBold"
                           Foreground="#2196F3"/>
              </Border>
              
              <!-- Captions -->
              <CheckBox Grid.Row="2" Grid.Column="0"
                        IsChecked="{Binding CopyCaptions, Mode=TwoWay}"
                        IsEnabled="{Binding HasCaptions}"
                        Margin="0,0,0,8">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <TextBlock Text="Captions" VerticalAlignment="Center"/>
                  <TextBlock Text="{Binding CaptionExtensionsDisplay}"
                             Opacity="0.5"
                             FontSize="11"
                             VerticalAlignment="Center"/>
                </StackPanel>
              </CheckBox>
              <Border Grid.Row="2" Grid.Column="1"
                      Background="#333"
                      CornerRadius="4"
                      Padding="8,4"
                      VerticalAlignment="Center">
                <TextBlock Text="{Binding CaptionCount}"
                           FontWeight="SemiBold"
                           Foreground="#FFC107"/>
              </Border>
              
              <!-- Ratings -->
              <CheckBox Grid.Row="3" Grid.Column="0"
                        IsChecked="{Binding CopyRatings, Mode=TwoWay}"
                        IsEnabled="{Binding HasFilteredRatedMedia}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <TextBlock Text="Ratings" VerticalAlignment="Center"/>
                  <TextBlock Text="(production ready / trash status)"
                             Opacity="0.5"
                             FontSize="11"
                             VerticalAlignment="Center"/>
                </StackPanel>
              </CheckBox>
              <Border Grid.Row="3" Grid.Column="1"
                      Background="#333"
                      CornerRadius="4"
                      Padding="8,4"
                      VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="4">
                  <TextBlock Text="{Binding FilteredProductionReadyCount}"
                             FontWeight="SemiBold"
                             Foreground="#4CAF50"/>
                  <TextBlock Text="/" Opacity="0.5"/>
                  <TextBlock Text="{Binding FilteredUnratedCount}"
                             FontWeight="SemiBold"
                             Foreground="#888"/>
                  <TextBlock Text="/" Opacity="0.5"/>
                  <TextBlock Text="{Binding FilteredTrashCount}"
                             FontWeight="SemiBold"
                             Foreground="#F44336"/>
                </StackPanel>
              </Border>
            </Grid>
          </StackPanel>
        </Border>
        
        <!-- To Copy Count (highlighted) - shown when copying and has selection -->
        <Border Background="#2D7D46" 
                CornerRadius="8" 
                Padding="16"
                Margin="0,0,0,20"
                IsVisible="{Binding IsCopyFromVersion}">
          <Grid ColumnDefinitions="*,Auto">
            <TextBlock Grid.Column="0" 
                       Text="Media files to copy:" 
                       FontWeight="SemiBold"
                       VerticalAlignment="Center"/>
            <TextBlock Grid.Column="1" 
                       Text="{Binding FilteredMediaCount}" 
                       FontWeight="Bold"
                       FontSize="16"
                       HorizontalAlignment="Right"/>
          </Grid>
        </Border>
        
        <!-- Warning when no rating selection -->
        <Border Background="#7D2D2D" 
                CornerRadius="8" 
                Padding="16"
                Margin="0,0,0,20"
                IsVisible="{Binding !HasRatingSelection}">
          <TextBlock Text="Select at least one rating category to copy."
                     HorizontalAlignment="Center"
                     FontWeight="SemiBold"/>
        </Border>
      </StackPanel>
    </Grid>

    <!-- Bottom Area: Info & Buttons -->
    <StackPanel Grid.Row="2" Spacing="20">
      
      <!-- Info Text for Start Fresh -->
      <Border Background="#2A2A2A" 
              CornerRadius="8" 
              Padding="12"
              IsVisible="{Binding IsStartFresh}">
        <StackPanel Orientation="Horizontal" Spacing="8">
          <TextBlock Text="?" Foreground="#4FC3F7" FontSize="16"/>
          <TextBlock Text="The new version will be empty.&#x0a;You can add training files after creation."
                     Opacity="0.8"
                     FontSize="12"
                     TextWrapping="Wrap"
                     VerticalAlignment="Center"/>
        </StackPanel>
      </Border>
      
      <Border Background="#2A2A2A" 
              CornerRadius="8" 
              Padding="12"
              IsVisible="{Binding IsCopyFromVersion}">
        <StackPanel Orientation="Horizontal" Spacing="8">
          <TextBlock Text="?" Foreground="#4FC3F7" FontSize="16"/>
          <TextBlock Text="Only media matching selected ratings will be copied.&#x0a;Original files remain unchanged."
                     Opacity="0.8"
                     FontSize="12"
                     TextWrapping="Wrap"
                     VerticalAlignment="Center"/>
        </StackPanel>
      </Border>
      
      <!-- Buttons -->
      <StackPanel Orientation="Horizontal" 
                  HorizontalAlignment="Right" 
                  Spacing="8">
        <Button Content="Cancel" 
                Width="100"
                Click="OnCancelClick"/>
        <Button Content="Create Version" 
                MinWidth="120"
                Background="#4CAF50"
                Foreground="White"
                FontWeight="SemiBold"
                IsDefault="True"
                Click="OnCreateClick"/>
      </StackPanel>
    </StackPanel>
    
  </Grid>
</Window>
